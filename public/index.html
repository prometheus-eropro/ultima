<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cartão AproveitAI – os benefícios</title>
  <meta name="theme-color" content="#0a7f2e">
  <link rel="icon" href="logo-192.png">
  <link rel="apple-touch-icon" href="logo-aproveitai.png">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="manifest" href="manifest.webmanifest">

  <style>
    :root {
      --verde: #0a7f2e;
      --verde-esc: #065e1f;
      --cinza: #f3f4f6;
      --cinza2: #e5e7eb;
      --azul: #3e6bee;
      --bg1: #bdeeff;
      --bg2: #81d4fa;
    }

    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      display: flex;
      flex-direction: column;
    }

    .topo {
      background: #fff;
      text-align: center;
      padding: 20px 10px;
      box-shadow: 0 2px 6px #0002;
    }

    .logo-line {
      display: flex;
      justify-content: space-around;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .logo-line img {
      max-height: 150px;
      max-width: 40%;
    }

    .brand-name {
      font-size: 2.2rem;
      font-weight: bold;
      color: var(--verde);
      background: #eaffeb;
      padding: 8px 20px;
      border-radius: 20px;
    }

    .slogan {
      font-size: 1.2rem;
      font-weight: 500;
      color: var(--verde-esc);
      margin-top: 6px;
    }

    .welcome-box {
      background: #ffffffcc;
      border-radius: 16px;
      margin: 20px auto;
      max-width: 800px;
      padding: 16px;
      box-shadow: 0 2px 10px #0002;
    }

    .cta-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin: 16px 0;
    }

    .cta-row a {
      text-decoration: none;
      background: var(--verde);
      color: #fff;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: bold;
    }
  </style>
<link rel="manifest" href="manifest.json" />


</head>
<body>
  <div class="topo">
    <div class="logo-line">
      <img src="logo-prometheus.png" alt="Logo Prometheus">
      <span class="brand-name">Cartão AproveitAI</span>
      <img src="logo-aproveitai.png" alt="Logo AproveitAI">
    </div>
    <div class="slogan">Tecnologia com ConsciêncIA gera Resultado.</div>
    <div class="welcome-box">
      <b>Bem-vindo à PROMETHEUS EROPRO Soluções Inteligentes!</b><br>
      Assine e experimente o <b>Cartão AproveitAI</b> e comece a economizar de verdade.
    </div>
    <div class="cta-row">
      <a href="cadastrocliente.html">Quero ser Cliente</a>
      <a href="areadocliente.html">Área do Cliente</a>      
      <a href="areadoparceiro.html">Área do Parceiro</a>
      <a href="cadastroparceiro.html">Quero ser Parceiro</a>
    </div>
  </div>

  <main class="container" style="padding: 16px; flex: 1;">
    <section class="filters" aria-label="Filtros de parceiros" style="background:#fff;border:1px solid var(--cinza2);border-radius:14px;padding:12px;display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:12px;margin-bottom:20px;">
      <input id="busca" type="search" placeholder="Buscar por nome ou @..." aria-label="Buscar">
      <select id="cidade" aria-label="Filtrar por cidade"><option value="">Todas as cidades</option></select>
      <select id="ramo" aria-label="Filtrar por ramo"><option value="">Todos os ramos</option></select>
      <button id="btnFiltrar" class="btn" aria-label="Aplicar filtros">Filtrar</button>
    </section>

    <div id="estado" class="state" role="status" aria-live="polite" style="text-align:center;margin:20px 0;">Carregando...</div>
    <section id="grid" class="grid" aria-label="Lista de parceiros" hidden
      style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px"></section>
    <div class="state" style="text-align:center"><button id="btnMais" class="btn secondary" hidden style="margin:20px auto;padding:10px 20px;border-radius:10px;">Carregar mais</button></div>
  </main>
  <footer class="site-footer" style="background:#052b15;color:#fff;padding:16px;display:flex;gap:16px;flex-wrap:wrap;align-items:center;justify-content:space-between;border-top:4px solid #0a7f2e">
    <div class="ft-col">
      <strong>Cartão AproveitAI</strong>
      <div class="mini">PROMETHEUS EROPRO Soluções Inteligentes LTDA · CNPJ 58.584.332/0001-40</div>
      <div class="mini">cartao.aproveitai@gmail.com · WhatsApp 028999692303 · Instagram: @cartao.aproveitai</div>
      <div class="mini" style="opacity:.9;margin-top:6px">© <span id="yr"></span> AproveitAI. Todos os direitos reservados.</div>
      <script>document.getElementById('yr')?.append(new Date().getFullYear());</script>
    </div>
    <nav class="footer-buttons" style="display:flex;gap:8px;flex-wrap:wrap">
      <a class="btn xs" href="beneficios.html">Benefícios</a>
      <a class="btn xs" href="promocoes.html">Promoções</a>
      <a class="btn xs" href="depoimentos.html">Depoimentos</a>
      <a class="btn xs" href="faq.html">Dúvidas</a>
      <a class="btn xs" href="privacidade.html">Privacidade</a>
      <a class="btn xs" href="termos.html">Termos</a>
      <a class="btn xs" href="excluir.html">Excluir dados</a>
    </nav>
  </footer>

<script>
async function fetchJSON(url) {
  const r = await fetch(url, { headers: { Accept: 'application/json' } });
  const text = await r.text();
  if (!r.ok) throw new Error(`HTTP ${r.status}: ${text.slice(0,200)}`);
  return JSON.parse(text);
}


    const API_PATH = "/api/gateway?tabela=parceiros";

    const PAGE_SIZE = 12;
    let nextOffset = "";
    let filtrosAtuais = { search: "", city: "", ramo: "" };
    const elEstado = document.getElementById('estado'),
          elGrid = document.getElementById('grid'),
          elMais = document.getElementById('btnMais'),
          elBusca = document.getElementById('busca'),
          elCidade = document.getElementById('cidade'),
          elRamo = document.getElementById('ramo');

    document.getElementById('btnFiltrar').addEventListener('click', () => {
      filtrosAtuais = {
        search: elBusca.value.trim(),
        city: elCidade.value,
        ramo: elRamo.value
      };
      listar(true);
    });

    elMais.addEventListener('click', () => listar(false));

    function placeholderLogo(nome) {
      const n = (nome || '?').trim().slice(0, 1).toUpperCase();
      return `<div style="width:80px;height:80px;border-radius:16px;background:#0a7f2e10;display:flex;align-items:center;justify-content:center;font-weight:700;color:#0a7f2e;font-size:28px">${n}</div>`;
    }

    function cardHtml(item) {
      const logo = item.logoUrl
  ? `<img src="${item.logoUrl}" alt="Logo de ${item.nome}" style="max-width:80%;max-height:100px;">`
  : `<img src="logo-aproveitai.png" alt="Logo padrão" style="max-width:80%;max-height:100px;">`;

      const desconto = item.desconto ? `<span class="pill">${item.desconto}</span>` : '';
      const cidadeRamo = [item.ramo, item.cidade].filter(Boolean).join(' • ');
      const insta = item.instagram ? `<a class="primary" href="${item.instagram}" target="_blank" rel="noopener" aria-label="Instagram">Instagram</a>` : '';
      const zap = item.whatsapp ? `<a href="${item.whatsapp}" target="_blank" rel="noopener" aria-label="WhatsApp">WhatsApp</a>` : '';
      return `<article class="card" style="background:#fff;border:1px solid #ddd;border-radius:16px;overflow:hidden;padding:12px;display:flex;flex-direction:column">
        <div class="thumb" style="height:140px;display:flex;align-items:center;justify-content:center;border-bottom:1px solid #eee">${logo}</div>
        <div class="content" style="display:flex;flex-direction:column;gap:8px">
          <h2 style="font-size:16px;margin:0">${item.nome || 'Parceiro'}</h2>
          <div class="muted" style="color:#555">${cidadeRamo}</div>
          <div class="actions" style="margin-top:auto;display:flex;gap:8px">${insta}${zap}</div>
        </div>
      </article>`;
    }

async function carregarClientes() {
  const data = await fetchJSON('/api/gateway?tabela=clientes&pageSize=50');
}

    async function fetchParceiros(offset) {
  const p = new URLSearchParams();
  p.set('pageSize', PAGE_SIZE);
  if (filtrosAtuais.search) p.set('search', filtrosAtuais.search);
  if (filtrosAtuais.city) p.set('city', filtrosAtuais.city);
  if (filtrosAtuais.ramo) p.set('ramo', filtrosAtuais.ramo);
  if (offset) p.set('offset', offset);

  const fullUrl = `${API_PATH}&${p.toString()}`;
  const data = await fetchJSON(fullUrl);
  return {
    items: (data.records || []).map(p => ({
      nome: p.fields.nomeFantasia,
      cidade: p.fields.cidade,
      ramo: p.fields.ramo,
      logoUrl: p.fields.logoURL,
      whatsapp: p.fields.whatsapp,
      instagram: p.fields.instagram,
      desconto: p.fields.desconto || ""
    })),
    nextOffset: data.offset
  };
}
    async function listar(reset) {
      try {
        if (reset) {
          nextOffset = "";
          elGrid.innerHTML = "";
          elGrid.hidden = true;
          elMais.hidden = true;
          elEstado.hidden = false;
          elEstado.textContent = "Carregando...";
        }
        const data = await fetchParceiros(nextOffset);
        const items = data.items || [];
        if (reset && !items.length) {
          elEstado.textContent = "Nenhum parceiro encontrado.";
          return;
        }
        elEstado.hidden = true;
        elGrid.hidden = false;
        elGrid.insertAdjacentHTML("beforeend", items.map(cardHtml).join(""));
        nextOffset = data.nextOffset || "";
        elMais.hidden = !nextOffset;
        if (reset) popularFiltrosFromDom();
      } catch (e) {
        console.error(e);
        elEstado.hidden = false;
        elEstado.textContent = "Erro ao carregar. Tente novamente mais tarde.";
      }
    }

    function popularFiltrosFromDom() {
      const cs = new Set(), rs = new Set();
      document.querySelectorAll('#grid .card .muted').forEach(el => {
        const [ramo, cidade] = (el.textContent || '').split(' • ').map(s => s.trim());
        if (cidade) cs.add(cidade);
        if (ramo) rs.add(ramo);
      });
      elCidade.innerHTML = ['<option value="">Todas as cidades</option>', ...[...cs].sort().map(c => `<option>${c}</option>`)].join('');
      elRamo.innerHTML = ['<option value="">Todos os ramos</option>', ...[...rs].sort().map(r => `<option>${r}</option>`)].join('');
    }

    listar(true);

<!-- index.html (trecho relevante, substituir JS) -->

     buscarBeneficios();
  async function buscarPromocoes() {
    const res = await fetch('/api/gateway?tabela=promocoes');
    const dados = await res.json();
    console.log('PROMOÇÕES:', dados);
  }

  buscarPromocoes();
  async function buscarDepoimentos() {
    const res = await fetch('/api/gateway?tabela=depoimentos');
    const dados = await res.json();
    console.log('DEPOIMENTOS:', dados);
  }

  buscarDepoimentos();


async function carregarParceiros() {
  try {
    const data = await fetchJSON('/api/gateway?tabela=parceiros&pageSize=50');
    let records = data.records || [];

    // eliminar duplicatas (baseado no CNPJ)
    const parceirosUnicos = [];
    const cnpjsVistos = new Set();
    records.forEach(parceiro => {
      const cnpj = parceiro.fields?.cnpj?.trim();
      if (cnpj && !cnpjsVistos.has(cnpj)) {
        parceirosUnicos.push(parceiro);
        cnpjsVistos.add(cnpj);
      }
    });

    const container = document.getElementById("lista-parceiros");
    if (!container) return;

    container.innerHTML = parceirosUnicos.map(p => {
      const f = p.fields;
      const logo = f.logoURL || "logo-aproveitai.png"; // fallback padrão
      return `
        <div class="parceiro-card" style="border:1px solid #ccc;padding:10px;border-radius:8px;text-align:center;width:180px">
          <img src="${logo}" alt="${f.nomeFantasia}" style="max-width:100px;margin-bottom:6px"/>
          <strong>${f.nomeFantasia || 'Sem nome'}</strong><br/>
          <small>${f.cidade || ''} • ${f.ramo || ''}</small>
        </div>
      `;
    }).join("");
  } catch (e) {
    console.error("Erro ao carregar parceiros:", e.message);
    const c = document.getElementById("lista-parceiros");
    if (c) c.innerHTML = `<p style="color:red">Erro ao carregar parceiros.</p>`;
  }
}

document.addEventListener("DOMContentLoaded", carregarParceiros);
</script>
<script>
  // Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(() => {});
  }

  // Outras buscas automáticas
  async function buscarFAQ() {
    try {
      const data = await fetchJSON('/api/gateway?tabela=faq');
      console.log('FAQ:', data);
    } catch (e) { console.error(e); }
  }

  async function buscarBeneficios() {
    const res = await fetch('/api/gateway?tabela=beneficios');
    const dados = await res.json();
    console.log('BENEFICIOS:', dados);
  }

  async function buscarPromocoes() {
    const res = await fetch('/api/gateway?tabela=promocoes');
    const dados = await res.json();
    console.log('PROMOÇÕES:', dados);
  }

  async function buscarDepoimentos() {
    const res = await fetch('/api/gateway?tabela=depoimentos');
    const dados = await res.json();
    console.log('DEPOIMENTOS:', dados);
  }

  buscarFAQ();
  buscarBeneficios();
  buscarPromocoes();
  buscarDepoimentos();
</script>

</body>
</html>
